---
layout:     post
title:      é»’åŸŸè¡¥ä¸åˆ¶ä½œ
subtitle:   çº¯æ‰‹æœºæ“ä½œï¼ˆéœ€rootï¼‰
date:       2017-07-17
author:    æ¯”ä¸˜
header-img: img/post-bg-coffee.jpeg
catalog: true
tags:
    - å®‰å“
    - é»’åŸŸ
---

#### å‡†å¤‡å·¥ä½œ  
1. å®‰è£…linux deployï¼Œé€‰æ‹©ubuntu16.04ï¼Œarm64ï¼Œç›®å½•/æ–‡ä»¶å®‰è£…ï¼Œå…·ä½“è¯·å‚è€ƒ[linx deploy éƒ¨ç½²-ç®€ä¹¦](http://www.jianshu.com/p/690e3e35a38f)  ï¼Œsshä¸€å®šè¦é€‰ï¼Œsftpè¦å¼€å¯ï¼ˆä¾¿äºä½¿ç”¨ï¼Œseæ–‡ä»¶ç®¡ç†å™¨æ”¯æŒsftpï¼‰
2. é…ç½®javaç¯å¢ƒå˜é‡ï¼Œä¸‹è½½javaæºä»£ç åŒ… [ä¸‹è½½åœ°å€](http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html) æ¶æ„è¯·é€‰æ‹©ä¸éƒ¨ç½²çš„ç›¸åŒ
###### é…ç½®ç¯å¢ƒå˜é‡ 
å‚è€ƒ[ubuntué…ç½®java](http://www.cnblogs.com/davidsky/archive/2013/06/01/3113310.html) 
![](http://ot6z44ono.bkt.clouddn.com/17-7-17/80152091.jpg)  
  
  
profile (å»ºè®®ç”¨seä¿®æ”¹ï¼Œvimå¤ªç´¯ğŸ˜‚ğŸ˜‚ğŸ˜‚)
```
# set jdk environment
export JAVA_HOME=/opt/jdk1.8.0_131
export JRE_HOME=/opt/jdk1.8.0_131/jre
export CLASSPATH=.:$CLASSPATH:$JAVA_HOME/lib:$JRE_HOME/lib
export PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin
$JRE_HOME/bin
# åˆ·æ–°é…ç½®
source /etc/profile
```
**æ‰“è¡¥ä¸è¿‡ç¨‹ä¸­è¦ä½¿ç”¨sudoæˆ–rootç”¨æˆ·ï¼Œrootç”¨æˆ·ä½¿ç”¨javaéœ€é…ç½®environment**ï¼Œå¦‚å›¾![](http://ot6z44ono.bkt.clouddn.com/17-7-17/27882679.jpg)
 environment (å»ºè®®ç”¨seä¿®æ”¹ï¼Œvimå¤ªç´¯ğŸ˜‚ğŸ˜‚ğŸ˜‚)
 ```
 PATH="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:$JAVA_HOME/bin"
 export CLASSPATH=.:$CLASSPATH:$JAVA_HOME/lib:$JRE_HOME/lib
export JAVA_HOME=/opt/jdk1.8.0_131
 ```
###### ä¸‹è½½ baksmali.jar oat2dex.jar smali.jar åŠé»’åŸŸæ‰€éœ€æ–‡ä»¶ï¼š [ç™¾åº¦äº‘](http://pan.baidu.com/s/1i566lk5)
###### æå–services.jar/odexåŒ–åæ‰€éœ€æ–‡ä»¶åŠjaræ–‡ä»¶æ”¾äºåŒä¸€æ–‡ä»¶å¤¹å†…
 
#### æ‰“è¡¥ä¸
 
 >*rootç”¨æˆ·è¿è¡Œæˆ–è€…sudoè¿è¡Œ  *
 
```
 cd <è¡¥ä¸æ–‡ä»¶ç›®å½•>
```  

```
 æœªodexåŒ–
 
 java -jar baksmali-2.2.1.jar d services.jar -o services  
--------------------------------------------------- 
 Android 5.0 - Android 5.1ï¼šodexåŒ–
 
 java -Xms1g -jar oat2dex.jar boot <boot.oatè·¯å¾„>
 java -Xms1g -jar oat2dex.jar <services.odexè·¯å¾„> <dexç›®å½•è·¯å¾„>
 java -Xms1g -jar baksmali-2.2.1.jar d <services.dexè·¯å¾„> -o services
 
 æ‰§è¡Œå®Œä»¥åï¼Œä¼šç”Ÿæˆä¸€ä¸ªæ–°ç›®å½•servicesä»¥åŠä¸­é—´è¿‡ç¨‹ç›®å½•odexä¸dexã€‚
 --------------------------------------------------
 Android 6.0 - Android 7.1ï¼šodexåŒ–
 
 java -Xms1g -jar baksmali-2.2.1.jar x -d <boot.oatæ‰€åœ¨ç›®å½•è·¯å¾„> <services.odexæ–‡ä»¶è·¯å¾„> -o services

æ³¨æ„: Android 7.0 åŠä»¥ä¸Šç‰ˆæœ¬ä¸­çš„boot.oatä¾èµ–åŒç›®å½•ä¸‹çš„å…¶å®ƒæ–‡ä»¶ï¼Œè¯·ä¸è¦ç§»åŠ¨boot.oatï¼Œç›´æ¥æŒ‡å®šå®ƒæ‰€åœ¨çš„ç›®å½•å°±å¥½ã€‚
å¦‚æœboot.oatæˆ–services.odexå‡ºç°åœ¨å¤šä¸ªç›®å½•ï¼Œä½¿ç”¨ä»»ä½•ä¸€ä¸ªå°±å¥½ã€‚æ³¨æ„ç›®å½•è·¯å¾„ä¸æ–‡ä»¶è·¯å¾„åŒºåˆ«

æ‰§è¡Œå®Œä»¥åï¼Œä¼šç”Ÿæˆä¸€ä¸ªæ–°ç›®å½•servicesã€‚
```
```
java -jar baksmali-2.2.1.jar d hy.apk -o apk
python patch.py -a apk -s services
--------------------------------------------------- 
æ‰§è¡Œå®Œä»¥åï¼Œä¼šæç¤ºä¸€å…±æ‰“äº†å¤šä¸ªä¸ªè¡¥ä¸ã€‚æ­£å¸¸çš„è¯ï¼ŒAndroid 4.4 ä¸€å…±æœ‰ 14 å¤„è¡¥ä¸ï¼Œ5.0 ä»¥ä¸Šå…±æœ‰ 15 å¤„è¡¥ä¸ã€‚
--------------------------------------------------- 
java -jar smali-2.2.1.jar a -o classes.dex services
jar -cvf services.jar classes.dex
```
- **odex**  
![](http://ot6z44ono.bkt.clouddn.com/17-7-17/58677974.jpg)
- **æœªodex**
![](http://ot6z44ono.bkt.clouddn.com/17-7-17/46715367.jpg)  

#### æ›¿æ¢æ–‡ä»¶,æ”¹æƒé™0644ï¼Œé‡å¯å³å¯

**è°ƒç”¨smaliä»¥åŠbaksmaliæ—¶éœ€è¦å¤„ç†è¾ƒé•¿æ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…**  
<strike>è‹¥å‡ºç°æ— æ³•ä½¿ç”¨pythonï¼Œè¯·source /etc/enviorment</strike>